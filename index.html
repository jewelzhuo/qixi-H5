<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-type" content="text/html"; charset="UTF-8">
	<title>慕课七夕主题</title>
	<link rel="stylesheet" type="text/css" href="style.css">
	<link rel="stylesheet" type="text/css" href="pageA.css">
	<link rel="stylesheet" type="text/css" href="pageB.css">
	<script src="http://libs.baidu.com/jquery/1.9.1/jquery.js"></script>
	<script src="Jquery_Transit.js" type="text/javascript"></script>
	<style type="text/css">

	</style>
</head>
<body>
	<div id="content">
		<ul class="content-wrap">
			<li>
				<div class="a_background">
					<div class="a_background_top"></div>
					<div class="a_background_middle"></div>
					<div class="a_background_bottom"></div>
				</div>
				<!-- 太阳 -->
				<div id="sun"></div>
				<!-- 飘云 -->
				<div class="cloudArea">
					<div class="cloud cloud1"></div>
					<div class="cloud cloud2"></div>
				</div>
			</li>
			<li>
				<!-- 背景图 -->
				<div class="b_background"></div>
				<div class="b_background_preload"></div>
				<!-- 商店 -->
				<div class="shop">
					<div class="door">
						<div class="door-left"></div>
						<div class="door-right"></div>
					</div>
					<!-- 灯 -->
					<div class="lamp"></div>
				</div>
			</li>
			<li> 页面3 </li>
		</ul>
		<div id="boy" class="charactor"></div>
		<div class="button">
			<button>开门</button>
			<button>关门</button>
		</div>
	</div>

	<script type="text/javascript">
		$(function() {

			var container = $('#content');
			
			var swipe = Swipe(container);
			function scrollTo(time, proportionX) {
				var distX = container.width() * proportionX;
				swipe.scrollTo(distX, time);
			};
			swipe.scrollTo(container.width(), 0);
			//var boy = BoyWalk();
			BoyWalk();
			// $('button').click(() => {
			// 	//太阳转动
			// 	$('#sun').addClass('rotation');

			// 	//飘云
			// 	$('.cloud1').addClass('cloud1Anim');
			// 	$('.cloud2').addClass('cloud2Anim');
				
			// 	boy.walkTo(2000, 0.2)
			// 		.then(function() {						
			// 			scrollTo(5000, 1);
			// 		}).then(function() {						
			// 			return boy.walkTo(5000, 0.5);
			// 		})
			// });
			
			function doorAction(left, right, time) {
				var doorLeft = $('.door-left');
				var doorRight = $('.door-right');
				var count = 2;
				var defer = $.Deferred();
				// 等待开门完成
				function complete() {					
					if (count == 1) {
						defer.resolve();
						return;
					};
					count--;
				}

				doorLeft.transition({
					'left': left
				}, time, complete);

				doorRight.transition({
					'left': right
				}, time, complete);

				return defer;
			};

			function openDoor() {
				return doorAction('-50%', '100%', 2000);
			};

			function shutDoor() {
				return doorAction('0%', '50%', 2000);
			};

			$('button:first').click(() => {
				openDoor();
			});
			$('button:last').click(() => {
				shutDoor();
			});			
		})
	</script>
	<script src="Swipe.js" type="text/javascript"></script>
	<script src="BoyWalk.js" type="text/javascript"></script>
</body>
</html>